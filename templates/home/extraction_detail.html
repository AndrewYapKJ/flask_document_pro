{% extends 'layouts/base.html' %}

{% block content %}
<div class="container">
  <h2>{{ template.name }}</h2>
  <p><strong>Bot ID:</strong> <code>{{ template.bot_id }}</code></p>
  <p><strong>Description:</strong> {{ template.description }}</p>
  <p><strong>Position based:</strong> {{ 'Yes' if template.is_position_based else 'No' }}</p>
  <h4>Fields</h4>
  <ul>
    {% for f in fields %}
      <li>{{ f.name }} ({{ f.field_type }})</li>
    {% endfor %}
  </ul>

  <h4>Test extraction</h4>
  <form id="extract-form" action="{{ url_for('home_blueprint.api_extract_by_bot', bot_id=template.bot_id) }}" method="post" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="file" class="form-label">Upload PDF/Image</label>
      <input type="file" name="file" id="file" class="form-control" accept="application/pdf,image/*" required />
    </div>
    <button class="btn btn-primary" type="submit">Run Extraction</button>
  </form>

  <div id="extract-result" style="margin-top:1rem;"></div>
</div>

{% block scripts %}
<script>
document.getElementById('extract-form').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  const res = await fetch(form.action, {method: 'POST', body: data});
  const json = await res.json();
  const container = document.getElementById('extract-result');
  if(json.success){
    container.innerHTML = '<pre>'+JSON.stringify(json.data, null, 2)+'</pre>';
  } else {
    container.innerHTML = '<div class="alert alert-danger">Error: '+(json.error||'unknown')+'</div>';
  }
});
</script>
{% endblock %}

{% endblock %}
